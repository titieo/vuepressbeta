"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createPage = void 0;
const inferPagePath_1 = require("./inferPagePath");
const resolvePageComponentInfo_1 = require("./resolvePageComponentInfo");
const resolvePageContent_1 = require("./resolvePageContent");
const resolvePageDataInfo_1 = require("./resolvePageDataInfo");
const resolvePageDate_1 = require("./resolvePageDate");
const resolvePageExcerpt_1 = require("./resolvePageExcerpt");
const resolvePageFileContent_1 = require("./resolvePageFileContent");
const resolvePageFilePath_1 = require("./resolvePageFilePath");
const resolvePageFrontmatter_1 = require("./resolvePageFrontmatter");
const resolvePageHtmlInfo_1 = require("./resolvePageHtmlInfo");
const resolvePageKey_1 = require("./resolvePageKey");
const resolvePageLang_1 = require("./resolvePageLang");
const resolvePagePath_1 = require("./resolvePagePath");
const resolvePagePermalink_1 = require("./resolvePagePermalink");
const resolvePageSlug_1 = require("./resolvePageSlug");
const resolvePageTitle_1 = require("./resolvePageTitle");
const createPage = async (app, options) => {
    // resolve page file absolute path and relative path
    const { filePath, filePathRelative } = resolvePageFilePath_1.resolvePageFilePath({
        app,
        options,
    });
    // read the raw file content according to the absolute file path
    const contentRaw = await resolvePageFileContent_1.resolvePageFileContent({ filePath, options });
    // resolve content & frontmatter & raw excerpt from raw content
    const { content, frontmatterRaw, excerptRaw } = resolvePageContent_1.resolvePageContent({
        contentRaw,
    });
    // resolve frontmatter from raw frontmatter and page options
    const frontmatter = resolvePageFrontmatter_1.resolvePageFrontmatter({ frontmatterRaw, options });
    // resolve excerpt from raw excerpt
    const excerpt = resolvePageExcerpt_1.resolvePageExcerpt({
        app,
        excerptRaw,
        filePath,
        filePathRelative,
        frontmatter,
    });
    // resolve slug from file path
    const slug = resolvePageSlug_1.resolvePageSlug({ filePathRelative });
    // resolve date from file path
    const date = resolvePageDate_1.resolvePageDate({ frontmatter, filePathRelative });
    // infer page path according to file path
    const { pathInferred, pathLocale } = inferPagePath_1.inferPagePath({ app, filePathRelative });
    // resolve language from frontmatter and site options
    const lang = resolvePageLang_1.resolvePageLang({ app, frontmatter, pathLocale });
    // resolve page permalink
    const permalink = resolvePagePermalink_1.resolvePagePermalink({
        frontmatter,
        slug,
        date,
        pathInferred,
        pathLocale,
    });
    // resolve page path
    const path = resolvePagePath_1.resolvePagePath({ permalink, pathInferred, options });
    // resolve path key
    const key = resolvePageKey_1.resolvePageKey({ path });
    // resolve page rendered html file path
    const { htmlFilePath, htmlFilePathRelative } = resolvePageHtmlInfo_1.resolvePageHtmlInfo({
        app,
        path,
    });
    // resolve page component and extract headers & links
    const { deps, headers, links, componentFilePath, componentFilePathRelative, componentFileContent, componentFileChunkName, } = await resolvePageComponentInfo_1.resolvePageComponentInfo({
        app,
        content,
        filePath,
        filePathRelative,
        frontmatter,
        htmlFilePathRelative,
        key,
    });
    const { dataFilePath, dataFilePathRelative, dataFileChunkName, } = resolvePageDataInfo_1.resolvePageDataInfo({ app, htmlFilePathRelative, key });
    // resolve title from frontmatter and headers
    const title = resolvePageTitle_1.resolvePageTitle({ content, frontmatter, headers });
    return {
        // page data
        key,
        path,
        title,
        lang,
        frontmatter,
        excerpt,
        headers,
        // extra data
        pathInferred,
        pathLocale,
        content,
        slug,
        date,
        deps,
        links,
        // file info
        filePath,
        filePathRelative,
        componentFilePath,
        componentFilePathRelative,
        componentFileContent,
        componentFileChunkName,
        dataFilePath,
        dataFilePathRelative,
        dataFileChunkName,
        htmlFilePath,
        htmlFilePathRelative,
    };
};
exports.createPage = createPage;
